{% extends "jukebox/admin_base.html" %}
{% block content %}
<div class="container-fluid">
  <h2 class="mb-4">Cançons per a <span class="text-primary">{{ party.name }}</span></h2>

  {% if songs %}
    <div class="table-responsive">
      <table class="table table-striped align-middle w-100">
        <thead>
          <tr>
            <th>Títol</th>
            <th>Artista</th>
            <th class="text-center">Vots</th>
            <th class="text-center">Acció</th>
          </tr>
        </thead>
        <tbody>
          {% for song in songs %}
            <tr>
              <td>{{ song.title }}</td>
              <td>{{ song.artist }}</td>
              <td class="text-center">{{ song.votes }}</td>
              <td class="text-center">
                <form method="post" style="margin:0;">
                  {% csrf_token %}
                  <input type="hidden" name="vote_song_id" value="{{ song.id }}">
                  <button type="submit" class="btn btn-sm btn-primary">
                    Vota
                  </button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info">No hi ha cançons per aquesta festa!</div>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var input = document.getElementById('song-search');
  if (!input) return;  // si no hi és, no fem res

  input.addEventListener('input', function() {
    var q = input.value.trim().toLowerCase();
    var rows = document.querySelectorAll('table tbody tr');

    rows.forEach(function(row) {
      // primer i segon <td> són títol i artista
      var title  = row.cells[0].textContent.toLowerCase();
      var artist = row.cells[1].textContent.toLowerCase();

      // si coincideix títol o artista, el mostrem, si no l'amaguem
      if ( title.includes(q) || artist.includes(q) ) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  });
});
</script>
{% endblock %}
